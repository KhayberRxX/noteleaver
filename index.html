<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã–zgÃ¼r Tuval | Hasan</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        :root { --bg: #0b0b0b; --panel: #1a1a1a; --accent: #00ff88; --text: #e0e0e0; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* Harita AlanÄ± */
        #map { width: 10000px; height: 10000px; position: relative; cursor: crosshair; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 50px 50px; transition: 0.1s; }
        
        /* SaÄŸ TÄ±k / Sol TÄ±k MenÃ¼sÃ¼ */
        #menu { position: absolute; background: var(--panel); border: 1px solid #444; border-radius: 8px; display: none; flex-direction: column; padding: 5px; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        #menu button { background: none; border: none; color: white; padding: 10px 20px; text-align: left; cursor: pointer; border-radius: 4px; }
        #menu button:hover { background: var(--accent); color: black; }

        /* NotlarÄ±n GÃ¶rÃ¼nÃ¼mÃ¼ */
        .item { position: absolute; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; max-width: 200px; word-wrap: break-word; pointer-events: all; }
        .item:hover { border-color: var(--accent); background: rgba(0, 255, 136, 0.1); }
        .item .info { display: none; position: absolute; bottom: 100%; left: 0; background: #000; font-size: 10px; color: var(--accent); padding: 2px 5px; border-radius: 3px; white-space: nowrap; }
        .item:hover .info { display: block; }

        /* Modal Pencereleri */
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--panel); padding: 25px; border-radius: 15px; z-index: 3000; border: 1px solid var(--accent); width: 320px; box-shadow: 0 0 20px rgba(0,255,136,0.2); }
        .hidden { display: none !important; }
        textarea, input { width: 100%; background: #000; color: white; border: 1px solid #444; padding: 10px; margin: 10px 0; border-radius: 5px; box-sizing: border-box; outline: none; }
        
        /* ArayÃ¼z ButonlarÄ± */
        #ui { position: fixed; top: 20px; left: 20px; z-index: 2000; display: flex; gap: 10px; pointer-events: none; }
        .ui-box { background: rgba(26,26,26,0.9); padding: 8px 15px; border-radius: 20px; border: 1px solid #444; pointer-events: all; font-size: 13px; }
        button.ui-box { cursor: pointer; color: white; transition: 0.3s; }
        button.ui-box:hover { border-color: var(--accent); }
    </style>
</head>
<body>

<div id="ui">
    <div class="ui-box">KimliÄŸin: <span id="my-id" style="color:var(--accent)">...</span></div>
    <div class="ui-box">ğŸ“š KÃ¼tÃ¼phane HakkÄ±: <span id="lib-count">3</span></div>
    <button class="ui-box" onclick="showAdmin()">âš™ï¸ Panel</button>
</div>

<div id="map"></div>

<div id="menu">
    <button onclick="openModal('note')">ğŸ“ Not BÄ±rak</button>
    <button onclick="openModal('draw')">ğŸ¨ Resim Yap</button>
    <button onclick="useLibrary()">ğŸ“š KÃ¼tÃ¼phane Kur (5 TL)</button>
</div>

<div id="modal" class="modal hidden">
    <h3 id="modal-title" style="margin-top:0">Ä°Ã§erik Ekle</h3>
    <textarea id="user-input" rows="4" placeholder="Buraya yaz..."></textarea>
    <button onclick="saveItem()" style="width:100%; padding:12px; background:var(--accent); border:none; border-radius:5px; cursor:pointer; font-weight:bold">YAYINLA</button>
    <button onclick="closeModal()" style="width:100%; background:none; color:gray; border:none; margin-top:10px; cursor:pointer">VazgeÃ§</button>
</div>

<div id="admin-modal" class="modal hidden">
    <h3 style="margin-top:0">ModeratÃ¶r GiriÅŸi</h3>
    <input type="password" id="admin-pass" placeholder="Åifre (Hasan0245)">
    <button onclick="checkAdmin()" style="width:100%; padding:10px; background:var(--accent); border:none; border-radius:5px; cursor:pointer">GiriÅŸ</button>
    <div id="admin-tools" class="hidden">
        <hr style="border:0.5px solid #444; margin:15px 0">
        <p style="color:red; font-size:12px">ADMÄ°N YETKÄ°SÄ° AKTÄ°F</p>
        <input type="text" id="target-id" placeholder="Banlanacak KullanÄ±cÄ± ID">
        <button onclick="alert('Ä°ÅŸlem baÅŸarÄ±lÄ±.')" style="color:red; background:none; border:1px solid red; width:100%; padding:5px; border-radius:5px; cursor:pointer">KullanÄ±cÄ±yÄ± Yasakla</button>
    </div>
    <button onclick="closeModal()" style="margin-top:10px; background:none; border:none; color:gray; cursor:pointer; width:100%">Kapat</button>
</div>

<script>
    // --- SUPABASE BAÄLANTISI ---
    const SUPABASE_URL = 'https://ssfgvjudifodfhovhpzx.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_hBGvHNaGoHd_5cLAKVUhqA_N87pXWQo';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let currentX, currentY, currentType;
    let userId = localStorage.getItem('userId') || "H-" + Math.floor(Math.random() * 9000 + 1000);
    localStorage.setItem('userId', userId);
    document.getElementById('my-id').innerText = userId;

    const map = document.getElementById('map');
    const menu = document.getElementById('menu');

    // Haritaya tÄ±klandÄ±ÄŸÄ±nda menÃ¼yÃ¼ gÃ¶ster
    map.addEventListener('click', (e) => {
        if(e.target !== map) return; // NotlarÄ±n Ã¼zerine tÄ±klayÄ±nca menÃ¼ aÃ§Ä±lmasÄ±n
        currentX = e.pageX;
        currentY = e.pageY;
        menu.style.display = 'flex';
        menu.style.left = currentX + 'px';
        menu.style.top = currentY + 'px';
    });

    function openModal(type) {
        currentType = type;
        document.getElementById('modal-title').innerText = type === 'note' ? 'Yeni Not' : 'KÃ¼tÃ¼phane OluÅŸtur';
        document.getElementById('modal').classList.remove('hidden');
        menu.style.display = 'none';
    }

    // VeritabanÄ±na Kaydet
    async function saveItem() {
        const content = document.getElementById('user-input').value;
        if(!content) return;

        const { error } = await supabase.from('items').insert([
            { type: currentType, content: content, x: currentX, y: currentY, user_id: userId }
        ]);

        if(!error) {
            renderItem(currentType, content, currentX, currentY, userId);
            closeModal();
            document.getElementById('user-input').value = "";
        } else {
            alert("Hata: " + error.message);
        }
    }

    // Ekran Ãœzerine Notu Ã‡iz
    function renderItem(type, content, x, y, author) {
        const div = document.createElement('div');
        div.className = 'item';
        div.style.left = x + 'px';
        div.style.top = y + 'px';
        
        // KÃ¼tÃ¼phane ise farklÄ± renk yapalÄ±m
        if(type === 'library') div.style.borderLeft = "4px solid " + var(--accent);

        div.innerHTML = `<span class="info">ID: ${author}</span> ${content}`;
        
        // Raporlama (SaÄŸ TÄ±k)
        div.oncontextmenu = (e) => {
            e.preventDefault();
            if(confirm(author + " ID'li bu iÃ§eriÄŸi raporlamak istiyor musun?")) {
                alert("Rapor moderatÃ¶rlere iletildi.");
            }
        };

        map.appendChild(div);
    }

    // TÃ¼m Verileri Supabase'den Ã‡ek
    async function loadData() {
        const { data, error } = await supabase.from('items').select('*');
        if(data) {
            data.forEach(i => renderItem(i.type, i.content, i.x, i.y, i.user_id));
        }
    }

    // Admin Åifre KontrolÃ¼
    function checkAdmin() {
        const pass = document.getElementById('admin-pass').value;
        if(pass === "Hasan0245") {
            document.getElementById('admin-tools').classList.remove('hidden');
        } else {
            alert("Åifre HatalÄ±!");
        }
    }

    // KÃ¼tÃ¼phane HakkÄ± YÃ¶netimi
    function useLibrary() {
        let count = parseInt(document.getElementById('lib-count').innerText);
        if(count > 0) {
            document.getElementById('lib-count').innerText = count - 1;
            openModal('library');
        } else {
            alert("Ãœcretsiz hakkÄ±n bitti. Yeni haklar iÃ§in 5 TL Ã¶deme yapmalÄ±sÄ±n.");
        }
    }

    function showAdmin() { document.getElementById('admin-modal').classList.remove('hidden'); }
    function closeModal() { document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden')); menu.style.display = 'none'; }

    // Sayfa yÃ¼klendiÄŸinde eski notlarÄ± getir
    window.onload = loadData;
    // Kodu bu sÄ±rayla kontrol et:
const SUPABASE_URL = 'https://ssfgvjudifodfhovhpzx.supabase.co';
const SUPABASE_KEY = 'sb_publishable_hBGvHNaGoHd_5cLAKVUhqA_N87pXWQo';

// EÄŸer yukarÄ±daki Key hala Ã§alÄ±ÅŸmÄ±yorsa Supabase API kÄ±smÄ±ndaki 
// "anon public" olanla deÄŸiÅŸtiÄŸinden emin ol.

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// Kimlik oluÅŸturma kÄ±smÄ±nÄ± en tepeye taÅŸÄ±
let userId = localStorage.getItem('userId');
if (!userId) {
    userId = "H-" + Math.floor(Math.random() * 9000 + 1000);
    localStorage.setItem('userId', userId);
}
document.getElementById('my-id').innerText = userId;
</script>

</body>
</html>
