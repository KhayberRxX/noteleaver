<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave a Note | Spawn & Focus</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;600;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --p: #00ff88; --p-rgb: 0, 255, 136;
            --bg: #010101; --card: rgba(10, 10, 10, 0.95);
            --border: rgba(255, 255, 255, 0.08);
            --danger: #ff2255;
        }

        * { box-sizing: border-box; outline: none; }
        body, html { 
            margin: 0; padding: 0; width: 100vw; height: 100vh; 
            overflow: hidden; background: var(--bg); color: white;
            font-family: 'Inter', sans-serif; cursor: none !important;
        }

        /* --- UI ELEMENTS --- */
        #cursor {
            width: 12px; height: 12px; background: var(--p); border-radius: 50%;
            position: fixed; pointer-events: none; z-index: 1000000;
            box-shadow: 0 0 15px var(--p);
        }

        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; background: #000; }
        #camera {
            width: 200000px; height: 200000px; position: absolute;
            background-image: 
                radial-gradient(circle at center, #222 1px, transparent 1.5px),
                linear-gradient(var(--border) 1px, transparent 1px),
                linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 100px 100px;
            transform-origin: 0 0; will-change: transform;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); /* Yumu≈üak Odaklanma */
        }

        /* --- SPAWN POINT VISUAL --- */
        #spawn-point {
            position: absolute; left: 100000px; top: 100000px;
            width: 200px; height: 200px; transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(var(--p-rgb), 0.2) 0%, transparent 70%);
            border: 2px dashed var(--p); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono'; font-weight: bold; color: var(--p);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); } 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); } }

        /* --- CONTEXT MENU --- */
        #ctx {
            position: fixed; display: none; flex-direction: column; width: 200px;
            background: var(--card); border: 1px solid var(--border);
            border-radius: 15px; z-index: 50000; padding: 8px; backdrop-filter: blur(10px);
        }
        .ctx-item { padding: 12px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; gap: 10px; }
        .ctx-item:hover { background: var(--p); color: #000; }

        /* --- NOT KARTLARI --- */
        .note {
            position: absolute; padding: 25px; background: var(--card);
            border: 1px solid var(--border); border-radius: 20px;
            min-width: 250px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .note h3 { margin: 0 0 10px 0; color: var(--p); font-size: 18px; }

        /* --- HUD & CONTROLS --- */
        #hud {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 15px; z-index: 10000;
        }
        .hud-btn {
            background: var(--card); border: 1px solid var(--border);
            padding: 12px 25px; border-radius: 50px; color: #fff;
            font-weight: bold; cursor: pointer; backdrop-filter: blur(10px);
            transition: 0.3s;
        }
        .hud-btn:hover { border-color: var(--p); box-shadow: 0 0 15px var(--p-glow); }

        /* --- MODAL --- */
        #modal-wrap {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            display: none; align-items: center; justify-content: center; z-index: 100000;
        }
        .modal {
            background: #0a0a0a; border: 1px solid var(--p);
            padding: 40px; border-radius: 30px; width: 450px;
        }
        input, textarea {
            width: 100%; background: #000; border: 1px solid #222;
            padding: 15px; border-radius: 12px; color: #fff; margin-bottom: 15px;
        }
    </style>
</head>
<body>

<div id="cursor"></div>

<div id="hud">
    <div class="hud-btn" onclick="Engine.spawn()">üè† Merkeze D√∂n</div>
    <div class="hud-btn" style="background:var(--p); color:#000" onclick="alert('Not bƒ±rakmak i√ßin haritaya SAƒû TIKLAYIN!')">üí° Nasƒ±l Kullanƒ±lƒ±r?</div>
</div>

<div id="modal-wrap">
    <div class="modal">
        <h2 style="margin-top:0">Yeni Veri Ekle</h2>
        <input type="text" id="in-title" placeholder="Ba≈ülƒ±k...">
        <textarea id="in-content" rows="5" placeholder="ƒ∞√ßerik..."></textarea>
        <button onclick="Engine.save()" style="width:100%; padding:15px; background:var(--p); border:none; border-radius:12px; font-weight:900; cursor:pointer">YAYINLA</button>
        <p onclick="document.getElementById('modal-wrap').style.display='none'" style="text-align:center; color:#444; cursor:pointer; margin-top:15px">ƒ∞ptal</p>
    </div>
</div>

<div id="ctx">
    <div class="ctx-item" onclick="Engine.openModal()">üìù Not Bƒ±rak</div>
</div>

<div id="viewport">
    <div id="camera">
        <div id="spawn-point">SPAWN AREA</div>
    </div>
</div>

<script>
const Engine = {
    config: {
        SB_URL: "https://ssfgvjudifodfhovhpzx.supabase.co",
        SB_KEY: "sb_publishable_hBGvHNaGoHd_5cLAKVUhqA_N87pXWQo",
        CENTER: 100000
    },

    state: {
        db: null,
        x: -100000, y: -100000, scale: 1,
        isDrag: false, lastM: {x:0, y:0},
        targetX: 0, targetY: 0
    },

    init: async function() {
        this.state.db = supabase.createClient(this.config.SB_URL, this.config.SB_KEY);
        this.bind();
        this.load();
        this.spawn(); // Ba≈ülangƒ±√ßta spawn'a git
    },

    bind: function() {
        window.onmousemove = (e) => {
            document.getElementById('cursor').style.left = e.clientX + 'px';
            document.getElementById('cursor').style.top = e.clientY + 'px';
            if(this.state.isDrag) {
                this.state.x += (e.clientX - this.state.lastM.x);
                this.state.y += (e.clientY - this.state.lastM.y);
                this.state.lastM = {x: e.clientX, y: e.clientY};
                this.render(false); // S√ºr√ºklerken transition olmasƒ±n
            }
        };

        window.onmousedown = (e) => {
            if(e.button === 0 && e.target.id === 'viewport' || e.target.id === 'camera') {
                this.state.isDrag = true;
                this.state.lastM = {x: e.clientX, y: e.clientY};
                document.getElementById('camera').style.transition = "none";
            }
        };

        window.onmouseup = () => this.state.isDrag = false;

        window.oncontextmenu = (e) => {
            e.preventDefault();
            const rect = document.getElementById('camera').getBoundingClientRect();
            this.state.targetX = Math.round((e.clientX - rect.left) / this.state.scale);
            this.state.targetY = Math.round((e.clientY - rect.top) / this.state.scale);
            
            const m = document.getElementById('ctx');
            m.style.display = 'flex'; m.style.left = e.clientX + 'px'; m.style.top = e.clientY + 'px';
        };

        window.onclick = () => document.getElementById('ctx').style.display = 'none';

        window.onwheel = (e) => {
            const d = e.deltaY > 0 ? 0.9 : 1.1;
            this.state.scale = Math.min(Math.max(0.1, this.state.scale * d), 3);
            this.render(false);
        };
    },

    spawn: function() {
        // Ekranƒ±n tam ortasƒ±nƒ± 100000,100000'e getir
        document.getElementById('camera').style.transition = "transform 1s cubic-bezier(0.23, 1, 0.32, 1)";
        this.state.x = -(this.config.CENTER * this.state.scale) + (window.innerWidth / 2);
        this.state.y = -(this.config.CENTER * this.state.scale) + (window.innerHeight / 2);
        this.render();
    },

    focusOn: function(worldX, worldY) {
        // Belirli bir koordinata odaklan
        document.getElementById('camera').style.transition = "transform 1.2s cubic-bezier(0.23, 1, 0.32, 1)";
        this.state.x = -(worldX * this.state.scale) + (window.innerWidth / 2);
        this.state.y = -(worldY * this.state.scale) + (window.innerHeight / 2);
        this.render();
    },

    render: function() {
        document.getElementById('camera').style.transform = `translate(${this.state.x}px, ${this.state.y}px) scale(${this.state.scale})`;
    },

    openModal: function() { document.getElementById('modal-wrap').style.display = 'flex'; },

    save: async function() {
        const title = document.getElementById('in-title').value;
        const content = document.getElementById('in-content').value;
        if(!title || !content) return;

        const { error } = await this.state.db.from('items').insert([{
            title, content, x: this.state.targetX, y: this.state.targetY, user_id: 'Hasan'
        }]);

        if(!error) {
            document.getElementById('modal-wrap').style.display = 'none';
            // Yeni notun yanƒ±na ƒ±≈üƒ±nlan
            this.focusOn(this.state.targetX, this.state.targetY);
            // Kartƒ± render et (sayfa yenilemeden)
            this.addNoteToMap({title, content, x: this.state.targetX, y: this.state.targetY});
        }
    },

    addNoteToMap: function(item) {
        const el = document.createElement('div');
        el.className = 'note';
        el.style.left = item.x + 'px'; el.style.top = item.y + 'px';
        el.innerHTML = `<h3>${item.title}</h3><p>${item.content}</p>`;
        document.getElementById('camera').appendChild(el);
    },

    load: async function() {
        const { data } = await this.state.db.from('items').select('*');
        data?.forEach(item => this.addNoteToMap(item));
    }
};

Engine.init();
</script>
</body>
</html>
