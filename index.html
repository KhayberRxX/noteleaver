<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave a Note | Omni Universe</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        /* --- K√úRESEL TASARIM Dƒ∞Lƒ∞ --- */
        :root {
            --p: #00ff88; --p-glow: rgba(0, 255, 136, 0.4);
            --bg: #020202; --s: #0f0f0f; --border: rgba(255,255,255,0.05);
            --danger: #ff0055; --danger-glow: rgba(255, 0, 85, 0.3);
        }

        * { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; cursor: none !important; }
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; background: var(--bg); color: #fff; }

        /* --- √ñZEL MOUSE CURSOR --- */
        #cursor {
            width: 20px; height: 20px; border: 2px solid var(--p); border-radius: 50%;
            position: fixed; pointer-events: none; z-index: 99999;
            box-shadow: 0 0 15px var(--p-glow); transition: transform 0.1s;
        }

        /* --- HARƒ∞TA MOTORU --- */
        #viewport { width: 100vw; height: 100vh; position: relative; overflow: hidden; perspective: 1500px; }
        #world {
            width: 100000px; height: 100000px; position: absolute;
            background: 
                radial-gradient(circle at center, rgba(0, 255, 136, 0.02) 0%, transparent 70%),
                linear-gradient(var(--border) 1px, transparent 1px) 0 0 / 100px 100px,
                linear-gradient(90deg, var(--border) 1px, transparent 1px) 0 0 / 100px 100px;
            will-change: transform; transform-origin: 0 0;
        }

        /* --- Dƒ∞NAMƒ∞K ARAY√úZ (OS STYLE) --- */
        #os-taskbar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(20px);
            padding: 10px 30px; border-radius: 25px; border: 1px solid var(--border);
            display: flex; gap: 25px; z-index: 10000; box-shadow: 0 15px 45px rgba(0,0,0,0.8);
        }

        .os-btn {
            font-size: 22px; cursor: pointer; transition: 0.3s;
            filter: grayscale(1); position: relative;
        }
        .os-btn:hover { filter: grayscale(0); transform: translateY(-5px); }
        .os-btn:active { transform: scale(0.9); }
        .os-btn::after {
            content: attr(data-label); position: absolute; top: -35px; left: 50%;
            transform: translateX(-50%); font-size: 10px; opacity: 0; color: var(--p);
        }
        .os-btn:hover::after { opacity: 1; }

        /* --- PENCERE Sƒ∞STEMƒ∞ --- */
        .win {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8);
            width: 500px; background: var(--s); border: 1px solid var(--border);
            border-radius: 30px; padding: 40px; display: none; z-index: 11000;
            box-shadow: 0 50px 100px rgba(0,0,0,0.9); opacity: 0;
        }
        .win.active { transform: translate(-50%, -50%) scale(1); opacity: 1; display: block; }

        /* --- NOT KARTLARI (3D ETKƒ∞Sƒ∞) --- */
        .node {
            position: absolute; padding: 25px; background: rgba(15,15,15,0.9);
            border: 1px solid var(--border); border-radius: 20px;
            min-width: 250px; transform-style: preserve-3d;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            animation: fadeIn 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .node:hover { border-color: var(--p); transform: translateZ(20px); z-index: 1000; }
        .node h3 { color: var(--p); margin: 0 0 10px 0; font-size: 20px; font-weight: 900; }
        .node p { font-size: 14px; color: #aaa; line-height: 1.6; }

        /* --- BAN & RAPOR MOD√úL√ú --- */
        #ban-screen {
            position: fixed; inset: 0; background: #000; z-index: 999999;
            display: none; align-items: center; justify-content: center; text-align: center;
        }
        .glitch-text { font-size: 50px; font-weight: 900; color: var(--danger); text-shadow: 2px 2px var(--p); }

        /* --- ADMƒ∞N G√ñZLEM --- */
        #admin-monitor {
            position: fixed; top: 20px; right: 20px; width: 300px;
            background: rgba(255,0,0,0.1); border: 1px solid var(--danger);
            padding: 15px; border-radius: 15px; display: none; z-index: 10001;
        }

        /* --- ZOOM & COORDINATE HUD --- */
        #hud {
            position: fixed; top: 20px; left: 20px; pointer-events: none;
            font-family: 'JetBrains Mono', monospace; font-size: 12px;
        }
    </style>
</head>
<body>

<div id="cursor"></div>

<div id="hud">
    <div>SYSTEM: <span id="status" style="color:var(--p)">STABLE</span></div>
    <div>COORDS: <span id="coords">0, 0</span></div>
    <div>ZOOM: <span id="zoom-val">1.0x</span></div>
</div>

<div id="ban-screen">
    <div>
        <div class="glitch-text">Sƒ∞STEMDEN UZAKLA≈ûTIRILDINIZ</div>
        <p>5 dakika boyunca giri≈ü yapƒ±lamaz. <br>Sebep: Raporlanan Uygunsuz ƒ∞√ßerik</p>
        <div id="timer" style="font-size: 30px; color: var(--p)">05:00</div>
    </div>
</div>

<div id="os-taskbar">
    <div class="os-btn" data-label="NOT EKLE" onclick="openWin('win-note')">üìù</div>
    <div class="os-btn" data-label="√áƒ∞Zƒ∞M YAP" onclick="openWin('win-draw')">üé®</div>
    <div class="os-btn" data-label="K√úT√úPHANE" onclick="openWin('win-lib')">üìö</div>
    <div class="os-btn" data-label="Y√ñNETƒ∞Cƒ∞" onclick="openWin('win-admin')">‚öôÔ∏è</div>
</div>

<div id="viewport">
    <div id="world"></div>
</div>

<div id="win-note" class="win">
    <h2>Evrene Not Bƒ±rak</h2>
    <input type="text" id="n-title" placeholder="Ba≈ülƒ±k (G√∂r√ºn√ºr)">
    <textarea id="n-body" rows="5" placeholder="Mesajƒ±nƒ±z..."></textarea>
    <button style="width:100%; padding:15px; background:var(--p); border:none; border-radius:15px; font-weight:bold; cursor:pointer" onclick="saveData('note')">YAYINLA</button>
</div>

<div id="win-admin" class="win">
    <h2>Admin Protokol√º</h2>
    <input type="password" id="admin-key" placeholder="Eri≈üim ≈ûifresi">
    <button style="width:100%; padding:15px; background:var(--danger); border:none; border-radius:15px; color:white; font-weight:bold; cursor:pointer" onclick="initAdmin()">ERƒ∞≈ûƒ∞M SAƒûLA</button>
    <div id="report-feed" style="margin-top:20px; display:none">
        <h4>üö® CANLI RAPOR AKI≈ûI</h4>
        <div id="reports" style="max-height: 200px; overflow-y: auto;"></div>
    </div>
</div>

<script>
    // --- OMNI ENGINE SCRIPT ---
    const SURL = "https://ssfgvjudifodfhovhpzx.supabase.co";
    const SKEY = "sb_publishable_hBGvHNaGoHd_5cLAKVUhqA_N87pXWQo";
    const _db = supabase.createClient(SURL, SKEY);

    let scale = 1, offX = -50000, offY = -50000;
    let isDrag = false, startX, startY;
    let userId = localStorage.getItem('omni_uid') || 'HX-' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('omni_uid', userId);

    const world = document.getElementById('world');
    const cursor = document.getElementById('cursor');

    // --- CURSOR MOTORU ---
    window.onmousemove = (e) => {
        cursor.style.left = e.clientX + 'px';
        cursor.style.top = e.clientY + 'px';
        
        const rect = world.getBoundingClientRect();
        const x = Math.round((e.clientX - rect.left) / scale);
        const y = Math.round((e.clientY - rect.top) / scale);
        document.getElementById('coords').innerText = `${x}, ${y}`;

        if(isDrag) {
            offX += (e.clientX - startX);
            offY += (e.clientY - startY);
            startX = e.clientX; startY = e.clientY;
            renderWorld();
        }
    };

    // --- ZOOM MOTORU ---
    window.onwheel = (e) => {
        const delta = e.deltaY > 0 ? 0.9 : 1.1;
        scale = Math.min(Math.max(0.05, scale * delta), 4);
        document.getElementById('zoom-val').innerText = scale.toFixed(1) + 'x';
        renderWorld();
    };

    window.onmousedown = (e) => { if(e.target.id === 'viewport' || e.target.id === 'world') { isDrag = true; startX = e.clientX; startY = e.clientY; }};
    window.onmouseup = () => isDrag = false;

    function renderWorld() {
        world.style.transform = `translate(${offX}px, ${offY}px) scale(${scale})`;
    }

    // --- UI FONKSƒ∞YONLARI ---
    function openWin(id) {
        document.querySelectorAll('.win').forEach(w => w.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- VERƒ∞ MOTORU ---
    async function saveData(type) {
        const title = document.getElementById('n-title').value;
        const content = document.getElementById('n-body').value;
        const rect = world.getBoundingClientRect();
        // Ekranƒ±n tam ortasƒ±na bƒ±rak
        const x = (window.innerWidth/2 - offX) / scale;
        const y = (window.innerHeight/2 - offY) / scale;

        const { error } = await _db.from('items').insert([{ title, content, x, y, type, user_id: userId }]);
        if(!error) location.reload();
    }

    async function loadUniverse() {
        const { data } = await _db.from('items').select('*');
        data?.forEach(obj => {
            const el = document.createElement('div');
            el.className = 'node';
            el.style.left = obj.x + 'px';
            el.style.top = obj.y + 'px';
            el.innerHTML = `
                <h3>${obj.title}</h3>
                <p>${obj.content}</p>
                <div style="margin-top:15px; display:flex; gap:10px">
                    <button onclick="report(${obj.id})" style="background:none; border:1px solid #444; color:#666; font-size:10px; cursor:pointer">üö© RAPOR</button>
                    <button class="adm-btn" onclick="banUser(${obj.id}, '${obj.user_id}')" style="display:none; color:red; background:none; border:1px solid red; cursor:pointer">Sƒ∞L & BAN</button>
                </div>
            `;
            world.appendChild(el);
        });
        renderWorld();
        checkBanStatus();
    }

    // --- BAN & ADMƒ∞N MEKANƒ∞ƒûƒ∞ ---
    async function checkBanStatus() {
        const { data } = await _db.from('site_users').select('banned_until').eq('user_id', userId).single();
        if(data && new Date(data.banned_until) > new Date()) {
            document.getElementById('ban-screen').style.display = 'flex';
        }
    }

    function initAdmin() {
        if(document.getElementById('admin-key').value === "Hasan0245") {
            document.querySelectorAll('.adm-btn').forEach(b => b.style.display = 'block');
            document.getElementById('report-feed').style.display = 'block';
            alert("ADMƒ∞N YETKƒ∞Sƒ∞ AKTƒ∞F");
            loadReports();
        }
    }

    async function banUser(id, targetId) {
        if(!confirm("Bu kullanƒ±cƒ±yƒ± 5 dakika banlamak ve i√ßeriƒüi silmek istiyor musunuz?")) return;
        await _db.from('items').delete().eq('id', id);
        const banTime = new Date(Date.now() + 5 * 60000).toISOString();
        await _db.from('site_users').upsert({ user_id: targetId, banned_until: banTime });
        location.reload();
    }

    window.onload = loadUniverse;
</script>
</body>
</html>
